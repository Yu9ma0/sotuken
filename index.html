<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚±ãƒ¼ã‚¹ãŒã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’åˆ‡ã‚ŠãŸãŒã‚‹</title>
<style>
  body { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; text-align: center; }
  button { padding: 1em 2em; font-size: 1.2em; margin-top: 20px; }
  video { width: 80%; max-width: 400px; margin-top: 20px; display: none; }
</style>
</head>
<body>

<h1>ã‚¹ãƒãƒ›ã‚±ãƒ¼ã‚¹ãŒã‚·ãƒ£ãƒƒã‚¿ãƒ¼ã‚’åˆ‡ã‚ŠãŸãŒã‚‹ã‚ˆï¼</h1>
<button id="triggerBtn">ãƒˆãƒ³ãƒˆãƒ³ã—ã¦æº–å‚™</button>
<audio id="obachanAudio" src="obachan_tonton.mp3"></audio>
<video id="cameraView" autoplay playsinline></video>
<button id="captureBtn" style="display:none;">ğŸ“¸ æ’®å½±</button>

<script>
  const triggerBtn = document.getElementById('triggerBtn');
  const audio = document.getElementById('obachanAudio');
  const video = document.getElementById('cameraView');
  const captureBtn = document.getElementById('captureBtn');

  let stream;

  // ãƒˆãƒ³ãƒˆãƒ³ãƒœã‚¿ãƒ³ â†’ éŸ³å£°å†ç”Ÿ
  triggerBtn.addEventListener('click', async () => {
    triggerBtn.disabled = true;
    await audio.play();

    // éŸ³å£°çµ‚äº†å¾Œã«ã‚«ãƒ¡ãƒ©èµ·å‹•
    audio.onended = async () => {
      // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
        video.style.display = 'block';
        captureBtn.style.display = 'inline-block';
      } catch (err) {
        alert('ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
      }
    };
  });

  // æ’®å½±ãƒœã‚¿ãƒ³
  captureBtn.addEventListener('click', () => {
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imgData = canvas.toDataURL('image/png');
    
    // å†™çœŸç¢ºèª
    const win = window.open();
    win.document.write(`<img src="${imgData}" style="max-width:100%">`);

    // ã‚«ãƒ¡ãƒ©ã‚¹ãƒˆãƒªãƒ¼ãƒ åœæ­¢
    stream.getTracks().forEach(track => track.stop());
  });
</script>

</body>
</html>
