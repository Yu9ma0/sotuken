<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Friend Award ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    label { display: block; margin-top: 1rem; font-weight: bold; }
    input, textarea {
      width: 100%; padding: 0.5rem; margin-top: 0.3rem; font-size: 1rem;
    }
    button {
      margin-top: 1.5rem; padding: 0.8rem 1.5rem;
      background: #6b3e00; color: white; border: none; border-radius: 6px;
      font-size: 1rem; cursor: pointer;
    }
    #awardPreview {
      margin-top: 2rem;
      padding: 2rem;
      border: 2px dashed #6b3e00;
      text-align: center;
      background: #fffaf0;
    }
    .title { font-size: 1.5rem; font-weight: bold; color: #6b3e00; }
    .to { margin-top: 1rem; font-size: 1.2rem; }
    .msg { margin: 1.5rem 0; font-style: italic; }
    .from { text-align: right; }
    #result { margin-top: 2rem; background: #f4f4f4; padding: 1rem; border-radius: 6px; word-break: break-all; }
  </style>
</head>
<body>
  <h1>Friend Award ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
  <label>è³ã®ã‚¿ã‚¤ãƒˆãƒ«</label>
  <input id="title" placeholder="ä¾‹: å†ä¼šè¨˜å¿µè³" />

  <label>å—è³è€…</label>
  <input id="to" placeholder="ä¾‹: å±±ç”° å¤ªéƒ" />

  <label>é€ã‚Šä¸»</label>
  <input id="from" placeholder="ä¾‹: éˆ´æœ¨ èŠ±å­" />

  <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
  <textarea id="msg" rows="4" placeholder="ä¾‹: ã¾ãŸä¼šãˆã¦å¬‰ã—ã‹ã£ãŸã‚ˆï¼ã“ã‚Œã‹ã‚‰ã‚‚ã‚ˆã‚ã—ãã­"></textarea>

  <button id="generateBtn">ğŸ“¸ æ’®å½±ãƒšãƒ¼ã‚¸URLã‚’ä½œæˆ</button>

  <div id="awardPreview">
    <div class="title" id="pTitle">è³ã‚¿ã‚¤ãƒˆãƒ«</div>
    <div class="to" id="pTo">â—¯â—¯ æ§˜</div>
    <div class="msg" id="pMsg">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    <div class="from" id="pFrom">From: èª°ã‹</div>
  </div>

  <div id="result"></div>

<script>
const CLOUDINARY_URL = 'https://api.cloudinary.com/v1_1/deqxzjvbi/image/upload';
const UPLOAD_PRESET = 'wfifas6f';

const titleInput = document.getElementById('title');
const toInput = document.getElementById('to');
const fromInput = document.getElementById('from');
const msgInput = document.getElementById('msg');

const pTitle = document.getElementById('pTitle');
const pTo = document.getElementById('pTo');
const pFrom = document.getElementById('pFrom');
const pMsg = document.getElementById('pMsg');

function updatePreview() {
  pTitle.textContent = titleInput.value || 'è³ã‚¿ã‚¤ãƒˆãƒ«';
  pTo.textContent = (toInput.value || 'â—¯â—¯') + ' æ§˜';
  pMsg.textContent = msgInput.value || 'ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™';
  pFrom.textContent = 'From: ' + (fromInput.value || 'èª°ã‹');
}

titleInput.addEventListener('input', updatePreview);
toInput.addEventListener('input', updatePreview);
fromInput.addEventListener('input', updatePreview);
msgInput.addEventListener('input', updatePreview);

const btn = document.getElementById('generateBtn');
btn.addEventListener('click', async () => {
  btn.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
  const target = document.getElementById('awardPreview');
  const canvas = await html2canvas(target);
  const dataUrl = canvas.toDataURL('image/png');

  const formData = new FormData();
  formData.append('file', dataUrl);
  formData.append('upload_preset', UPLOAD_PRESET);

  try {
    const res = await fetch(CLOUDINARY_URL, {
      method: 'POST',
      body: formData
    });
    const data = await res.json();
    const imageUrl = data.secure_url;
    const encoded = encodeURIComponent(imageUrl);
    const arUrl = `https://yu9ma0.github.io/sotuken/view.html?img=${encoded}`;
    document.getElementById('result').innerHTML = `
      <p><strong>æ’®å½±ãƒšãƒ¼ã‚¸URL:</strong></p>
      <input type="text" value="${arUrl}" readonly onclick="this.select()" style="width:100%; padding:0.5rem;" />
      <p><a href="${arUrl}" target="_blank">â–¶ æ’®å½±ãƒšãƒ¼ã‚¸ã‚’é–‹ã</a></p>
    `;
    btn.textContent = 'ğŸ“¸ æ’®å½±ãƒšãƒ¼ã‚¸URLã‚’ä½œæˆ';
  } catch (e) {
    alert('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸ');
    btn.textContent = 'ğŸ“¸ æ’®å½±ãƒšãƒ¼ã‚¸URLã‚’ä½œæˆ';
  }
});
</script>
</body>
</html>
